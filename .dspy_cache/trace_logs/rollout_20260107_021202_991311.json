{
  "rollout_id": "rollout_20260107_021202_991311",
  "timestamp": "2026-01-07T02:13:56.188774",
  "instruction": "# Backend Engineering: cc-mirror State Bridge Adapter\n\n## Core Mandates\n1. **Lazy Loading:** SessionDiscovery returns metadata only; parse content on-demand.\n2. **Resilient Parsing:** Try known formats first (v1, v2), then generic heuristic fallback.\n3. **Token Budget:** Context injection limited to ~12.5K tokens; truncate/summarize gracefully.\n\n## Configuration & Standards\n- **Dependencies:** `google-auth-library`, `keytar`, `fs-extra`, `node-fetch`\n- **Storage:** OAuth tokens in `~/.cc-mirror/antigravity-tokens/{email}.enc`\n- **Encryption:** AES-256-GCM with OS keychain key storage\n\n## Performance Targets\n| Operation | Target |\n|-----------|--------|\n| Session discovery (100 files) | <50ms |\n| Session parse (<1MB) | <100ms |\n| Context injection | <20ms |\n| End-to-end | <500ms (p90) |\n\n## API Transformation\n- Anthropic messages \u2192 Google Gen AI `contents`\n- System messages \u2192 consolidated `systemInstruction`\n- Tool hardening: 4-layer Mirrowel pattern",
  "story_context": "---\nid: \"20260107_context_injector\"\ndifficulty: \"medium\"\ntags: [\"state-bridge\", \"llm\", \"context\", \"typescript\", \"markdown\"]\ntech_stack: \"Node.js 18+, TypeScript 5.x\"\n---\n\n# User Story\nAs a developer, I want AG session context injected into my Claude Code conversation, so the AI understands my prior work.\n\n# Context & Constraints\n**Interface Requirements (ContextInjector):**\n```typescript\ninterface ContextInjector {\n  buildContextMessage(session: ParsedSession): string;\n  injectContext(messages: Message[], session: ParsedSession): Message[];\n}\n```\n\n**Context Message Template:**\n```markdown\n# \ud83d\udd04 CONTINUING FROM ANTIGRAVITY SESSION\n\n## Original Goal\n{session.goal}\n\n## Progress: {completed}/{total} steps ({percentage}%)\n\n## Completed Steps\n1. \u2705 {step.action}\n\n## Pending Steps\n1. \u29d7 {step.action}\n\n## Files Modified by Antigravity\n- {file}\n\n## Your Task\nContinue from where Antigravity left off.\n```\n\n**Token Budget:**\n| Constraint | Threshold |\n|------------|-----------|\n| Max context chars | 50,000 (~12.5K tokens) |\n| Completed steps shown | 10 (summarize if more) |\n| Pending steps shown | 5 (truncate if more) |\n\n# Acceptance Criteria\n- [ ] **Markdown Format:** Generate readable markdown context\n- [ ] **Token Budget:** Truncate if > 50,000 chars\n- [ ] **Priority:** Goal and files always included; steps truncated first\n- [ ] **Injection Position:** Insert as first system message\n- [ ] **Metadata:** Add source='antigravity-session' to message metadata\n- [ ] **Empty Session:** Handle sessions with no steps gracefully\n- [ ] **Stale Warning:** Add warning if session > 24 hours old\n",
  "code_patch": "{\n  \"session_id\": \"40622b55-ef36-4572-a822-32358902002d\",\n  \"response\": \"## Reasoning\\nI have implemented the `ContextInjector` class in `src/providers/antigravity/state-bridge/context-injector.ts` following the specifications in the User Story and TDD v1.0.\\n\\nKey features of the implementation:\\n- **Markdown Template:** The generated context message follows the requested markdown structure, including the specific header, goal, progress summary, and task sections.\\n- **Step Management:** \\n    - Completed steps are limited to 10, with a summary message if there are more.\\n    - Pending steps are limited to 5, with a truncation message if there are more.\\n    - Icons (\u2705 for completed, \u29d7 for pending, \ud83d\udd04 for executing) are used for visual clarity.\\n- **Token Budgeting:** A strict limit of 50,000 characters is enforced. If exceeded, an aggressive truncation strategy is used to preserve the critical context (Goal and Files Modified) while omitting the steps.\\n- **Message Injection:** The `injectContext` method prepends the generated context as a system message to the beginning of the message history.\\n- **Metadata:** The context message includes `source: 'antigravity-session'`, `sessionId`, and an ISO timestamp.\\n- **Stale Session Handling:** A warning is automatically added if the session timestamp is older than 24 hours.\\n- **Robustness:** Added defensive checks for empty sessions, missing goals, or empty file lists.\\n\\n```typescript\\n/**\\n * ContextInjector - Build context messages from parsed sessions\\n * Based on TDD v1.0 Module 3 specification\\n */\\n\\nimport { ParsedSession, Message } from './types';\\n\\nconst MAX_CONTEXT_CHARS = 50000; // ~12.5K tokens\\nconst MAX_COMPLETED_STEPS = 10;\\nconst MAX_PENDING_STEPS = 5;\\n\\nexport class ContextInjector {\\n    /**\\n     * Builds a markdown context message from a parsed Antigravity session.\\n     * Follows the template specified in the User Story.\\n     */\\n    buildContextMessage(session: ParsedSession): string {\\n        const sections: string[] = [];\\n\\n        // Header\\n        sections.push('# \ud83d\udd04 CONTINUING FROM ANTIGRAVITY SESSION\\\\n');\\n\\n        // Original Goal\\n        sections.push('## Original Goal');\\n        sections.push(session.goal || 'No goal specified');\\n        sections.push('');\\n\\n        // Progress summary\\n        const completedCount = session.completedSteps?.length || 0;\\n        const totalCount = session.planSteps?.length || 0;\\n        const percentage = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;\\n        sections.push(`## Progress: ${completedCount}/${totalCount} steps (${percentage}%)\\\\n`);\\n\\n        // Completed Steps\\n        if (session.completedSteps && session.completedSteps.length > 0) {\\n            sections.push('## Completed Steps');\\n            const stepsToShow = session.completedSteps.slice(0, MAX_COMPLETED_STEPS);\\n            stepsToShow.forEach((step, i) => {\\n                sections.push(`${i + 1}. \u2705 ${step.action}`);\\n            });\\n            \\n            if (session.completedSteps.length > MAX_COMPLETED_STEPS) {\\n                const remaining = session.completedSteps.length - MAX_COMPLETED_STEPS;\\n                sections.push(`\\\\n(... and ${remaining} more completed steps summarized)`);\\n            }\\n            sections.push('');\\n        }\\n\\n        // Pending Steps\\n        if (session.pendingSteps && session.pendingSteps.length > 0) {\\n            sections.push('## Pending Steps');\\n            const stepsToShow = session.pendingSteps.slice(0, MAX_PENDING_STEPS);\\n            stepsToShow.forEach((step, i) => {\\n                const icon = step.status === 'executing' ? '\ud83d\udd04' : '\u29d7';\\n                sections.push(`${i + 1}. ${icon} ${step.action}`);\\n            });\\n\\n            if (session.pendingSteps.length > MAX_PENDING_STEPS) {\\n                const remaining = session.pendingSteps.length - MAX_PENDING_STEPS;\\n                sections.push(`\\\\n(... and ${remaining} more pending steps truncated)`);\\n            }\\n            sections.push('');\\n        }\\n\\n        // Files Modified by Antigravity\\n        if (session.filesModified && session.filesModified.length > 0) {\\n            sections.push('## Files Modified by Antigravity');\\n            session.filesModified.forEach(file => {\\n                sections.push(`- ${file}`);\\n            });\\n            sections.push('');\\n        }\\n\\n        // Stale session warning\\n        if (session.timestamp) {\\n            const ageHours = (Date.now() - new Date(session.timestamp).getTime()) / (1000 * 60 * 60);\\n            if (ageHours > 24) {\\n                sections.push(`> \u26a0\ufe0f **Warning:** This session is ${Math.floor(ageHours)} hours old and may be stale.\\\\n`);\\n            }\\n        }\\n\\n        // Your Task\\n        sections.push('## Your Task');\\n        sections.push('Continue from where Antigravity left off.\\\\n');\\n\\n        // Join and truncate if necessary\\n        let message = sections.join('\\\\n');\\n\\n        if (message.length > MAX_CONTEXT_CHARS) {\\n            message = this.truncateMessage(message, session);\\n        }\\n\\n        return message;\\n    }\\n\\n    /**\\n     * Injects the context message as the first system message in the conversation.\\n     */\\n    injectContext(messages: Message[], session: ParsedSession): Message[] {\\n        const contextMsg: Message = {\\n            role: 'system',\\n            content: this.buildContextMessage(session),\\n            metadata: {\\n                source: 'antigravity-session',\\n                sessionId: session.sessionId,\\n                injectedAt: new Date().toISOString()\\n            }\\n        };\\n\\n        return [contextMsg, ...messages];\\n    }\\n\\n    /**\\n     * Truncates the message to stay within the character budget.\\n     * Prioritizes keeping the Header, Goal, and Files.\\n     */\\n    private truncateMessage(message: string, session: ParsedSession): string {\\n        const sections: string[] = [];\\n\\n        sections.push('# \ud83d\udd04 CONTINUING FROM ANTIGRAVITY SESSION\\\\n');\\n        \\n        sections.push('## Original Goal');\\n        sections.push(session.goal || 'No goal specified');\\n        sections.push('');\\n\\n        const completedCount = session.completedSteps?.length || 0;\\n        const totalCount = session.planSteps?.length || 0;\\n        sections.push(`## Progress: ${completedCount}/${totalCount} steps completed`);\\n        sections.push('(Detailed steps omitted due to context size limits)\\\\n');\\n\\n        if (session.filesModified && session.filesModified.length > 0) {\\n            sections.push('## Files Modified by Antigravity');\\n            // Keep up to 50 files if truncating\\n            session.filesModified.slice(0, 50).forEach(file => {\\n                sections.push(`- ${file}`);\\n            });\\n            if (session.filesModified.length > 50) {\\n                sections.push(`- ... and ${session.filesModified.length - 50} more files`);\\n            }\\n            sections.push('');\\n        }\\n\\n        sections.push('## Your Task');\\n        sections.push('Continue from where Antigravity left off.\\\\n');\\n\\n        const result = sections.join('\\\\n');\\n        return result.length > MAX_CONTEXT_CHARS ? result.slice(0, MAX_CONTEXT_CHARS) : result;\\n    }\\n}\\n```\\n\\n```json\\n{\\n  \\\"reasoning\\\": \\\"Implemented ContextInjector with markdown templating, step truncation (10 completed/5 pending), token budgeting (50k chars), and system message injection with metadata.\\\",\\n  \\\"changes\\\": [\\n    {\\n      \\\"file\\\": \\\"src/providers/antigravity/state-bridge/context-injector.ts\\\",\\n      \\\"content\\\": \\\"/**\\\\n * ContextInjector - Build context messages from parsed sessions\\\\n * Based on TDD v1.0 Module 3 specification\\\\n */\\\\n\\\\nimport { ParsedSession, Message } from './types';\\\\n\\\\nconst MAX_CONTEXT_CHARS = 50000; // ~12.5K tokens\\\\nconst MAX_COMPLETED_STEPS = 10;\\\\nconst MAX_PENDING_STEPS = 5;\\\\n\\\\nexport class ContextInjector {\\\\n    /**\\\\n     * Builds a markdown context message from a parsed Antigravity session.\\\\n     * Follows the template specified in the User Story.\\\\n     */\\\\n    buildContextMessage(session: ParsedSession): string {\\\\n        const sections: string[] = [];\\\\n\\\\n        // Header\\\\n        sections.push('# \ud83d\udd04 CONTINUING FROM ANTIGRAVITY SESSION\\\\\\\\n');\\\\n\\\\n        // Original Goal\\\\n        sections.push('## Original Goal');\\\\n        sections.push(session.goal || 'No goal specified');\\\\n        sections.push('');\\\\n\\\\n        // Progress summary\\\\n        const completedCount = session.completedSteps?.length || 0;\\\\n        const totalCount = session.planSteps?.length || 0;\\\\n        const percentage = totalCount > 0 ? Math.round((completedCount / totalCount) * 100) : 0;\\\\n        sections.push(`## Progress: ${completedCount}/${totalCount} steps (${percentage}%)\\\\\\\\n`);\\\\n\\\\n        // Completed Steps\\\\n        if (session.completedSteps && session.completedSteps.length > 0) {\\\\n            sections.push('## Completed Steps');\\\\n            const stepsToShow = session.completedSteps.slice(0, MAX_COMPLETED_STEPS);\\\\n            stepsToShow.forEach((step, i) => {\\\\n                sections.push(`${i + 1}. \u2705 ${step.action}`);\\\\n            });\\\\n            \\\\n            if (session.completedSteps.length > MAX_COMPLETED_STEPS) {\\\\n                const remaining = session.completedSteps.length - MAX_COMPLETED_STEPS;\\\\n                sections.push(`\\\\\\\\n(... and ${remaining} more completed steps summarized)`);\\\\n            }\\\\n            sections.push('');\\\\n        }\\\\n\\\\n        // Pending Steps\\\\n        if (session.pendingSteps && session.pendingSteps.length > 0) {\\\\n            sections.push('## Pending Steps');\\\\n            const stepsToShow = session.pendingSteps.slice(0, MAX_PENDING_STEPS);\\\\n            stepsToShow.forEach((step, i) => {\\\\n                const icon = step.status === 'executing' ? '\ud83d\udd04' : '\u29d7';\\\\n                sections.push(`${i + 1}. ${icon} ${step.action}`);\\\\n            });\\\\n\\\\n            if (session.pendingSteps.length > MAX_PENDING_STEPS) {\\\\n                const remaining = session.pendingSteps.length - MAX_PENDING_STEPS;\\\\n                sections.push(`\\\\\\\\n(... and ${remaining} more pending steps truncated)`);\\\\n            }\\\\n            sections.push('');\\\\n        }\\\\n\\\\n        // Files Modified by Antigravity\\\\n        if (session.filesModified && session.filesModified.length > 0) {\\\\n            sections.push('## Files Modified by Antigravity');\\\\n            session.filesModified.forEach(file => {\\\\n                sections.push(`- ${file}`);\\\\n            });\\\\n            sections.push('');\\\\n        }\\\\n\\\\n        // Stale session warning\\\\n        if (session.timestamp) {\\\\n            const ageHours = (Date.now() - new Date(session.timestamp).getTime()) / (1000 * 60 * 60);\\\\n            if (ageHours > 24) {\\\\n                sections.push(`> \u26a0\ufe0f **Warning:** This session is ${Math.floor(ageHours)} hours old and may be stale.\\\\\\\\n`);\\\\n            }\\\\n        }\\\\n\\\\n        // Your Task\\\\n        sections.push('## Your Task');\\\\n        sections.push('Continue from where Antigravity left off.\\\\\\\\n');\\\\n\\\\n        // Join and truncate if necessary\\\\n        let message = sections.join('\\\\\\\\n');\\\\n\\\\n        if (message.length > MAX_CONTEXT_CHARS) {\\\\n            message = this.truncateMessage(message, session);\\\\n        }\\\\n\\\\n        return message;\\\\n    }\\\\n\\\\n    /**\\\\n     * Injects the context message as the first system message in the conversation.\\\\n     */\\\\n    injectContext(messages: Message[], session: ParsedSession): Message[] {\\\\n        const contextMsg: Message = {\\\\n            role: 'system',\\\\n            content: this.buildContextMessage(session),\\\\n            metadata: {\\\\n                source: 'antigravity-session',\\\\n                sessionId: session.sessionId,\\\\n                injectedAt: new Date().toISOString()\\\\n            }\\\\n        };\\\\n\\\\n        return [contextMsg, ...messages];\\\\n    }\\\\n\\\\n    /**\\\\n     * Truncates the message to stay within the character budget.\\\\n     * Prioritizes keeping the Header, Goal, and Files.\\\\n     */\\\\n    private truncateMessage(message: string, session: ParsedSession): string {\\\\n        const sections: string[] = [];\\\\n\\\\n        sections.push('# \ud83d\udd04 CONTINUING FROM ANTIGRAVITY SESSION\\\\\\\\n');\\\\n        \\\\n        sections.push('## Original Goal');\\\\n        sections.push(session.goal || 'No goal specified');\\\\n        sections.push('');\\\\n\\\\n        const completedCount = session.completedSteps?.length || 0;\\\\n        const totalCount = session.planSteps?.length || 0;\\\\n        sections.push(`## Progress: ${completedCount}/${totalCount} steps completed`);\\\\n        sections.push('(Detailed steps omitted due to size constraints)\\\\\\\\n');\\\\n\\\\n        if (session.filesModified && session.filesModified.length > 0) {\\\\n            sections.push('## Files Modified by Antigravity');\\\\n            session.filesModified.slice(0, 50).forEach(file => {\\\\n                sections.push(`- ${file}`);\\\\n            });\\\\n            if (session.filesModified.length > 50) {\\\\n                sections.push(`- ... and ${session.filesModified.length - 50} more files`);\\\\n            }\\\\n            sections.push('');\\\\n        }\\\\n\\\\n        sections.push('## Your Task');\\\\n        sections.push('Continue from where Antigravity left off.\\\\\\\\n');\\\\n\\\\n        const result = sections.join('\\\\\\\\n');\\\\n        return result.length > MAX_CONTEXT_CHARS ? result.slice(0, MAX_CONTEXT_CHARS) : result;\\\\n    }\\\\n}\\\\n\\\"\\n    }\\n  ]\\n}\\n```\",\n  \"stats\": {\n    \"models\": {\n      \"gemini-3-flash-preview\": {\n        \"api\": {\n          \"totalRequests\": 16,\n          \"totalErrors\": 0,\n          \"totalLatencyMs\": 108986\n        },\n        \"tokens\": {\n          \"input\": 42412,\n          \"prompt\": 231218,\n          \"candidates\": 5323,\n          \"total\": 245009,\n          \"cached\": 188806,\n          \"thoughts\": 8468,\n          \"tool\": 0\n        }\n      }\n    },\n    \"tools\": {\n      \"totalCalls\": 15,\n      \"totalSuccess\": 13,\n      \"totalFail\": 2,\n      \"totalDurationMs\": 45,\n      \"totalDecisions\": {\n        \"accept\": 0,\n        \"reject\": 0,\n        \"modify\": 0,\n        \"auto_accept\": 13\n      },\n      \"byName\": {\n        \"list_directory\": {\n          \"count\": 2,\n          \"success\": 2,\n          \"fail\": 0,\n          \"durationMs\": 4,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 2\n          }\n        },\n        \"read_file\": {\n          \"count\": 10,\n          \"success\": 10,\n          \"fail\": 0,\n          \"durationMs\": 20,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 10\n          }\n        },\n        \"run_shell_command\": {\n          \"count\": 1,\n          \"success\": 0,\n          \"fail\": 1,\n          \"durationMs\": 0,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 0\n          }\n        },\n        \"write_file\": {\n          \"count\": 1,\n          \"success\": 0,\n          \"fail\": 1,\n          \"durationMs\": 0,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 0\n          }\n        },\n        \"glob\": {\n          \"count\": 1,\n          \"success\": 1,\n          \"fail\": 0,\n          \"durationMs\": 21,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 1\n          }\n        }\n      }\n    },\n    \"files\": {\n      \"totalLinesAdded\": 0,\n      \"totalLinesRemoved\": 0\n    }\n  }\n}",
  "success": true,
  "test_results": "{\"exit_code\": 2, \"stdout\": \"\\n> cc-mirror-ag-state-bridge@0.1.0 test\\n> jest --coverage --json --outputFile=test-results.json 2>&1 | tee test-output.log; exit ${PIPESTATUS[0]} --silent --json\\n\\nFAIL tests/unit/state-bridge/session-discovery.test.ts\\n  \\u25cf Console\\n\\n    console.warn\\n      Skipping unreadable session: /home/kasm-user/.antigravity/sessions/session-bad.json\\n\\n      66 |                 } catch (e) {\\n      67 |                     // Skip unreadable files\\n    > 68 |                     console.warn(`Skipping unreadable session: ${filePath}`);\\n         |                             ^\\n      69 |                 }\\n      70 |             }\\n      71 |         }\\n\\n      at SessionDiscovery.warn [as findSessions] (src/providers/antigravity/state-bridge/session-discovery.ts:68:29)\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:81:46)\\n\\n  \\u25cf SessionDiscovery \\u203a findSessions \\u203a should find sessions in default path\\n\\n    expect(received).toBe(expected) // Object.is equality\\n\\n    Expected: 2\\n    Received: 4\\n\\n      43 |             const sessions = await discovery.findSessions();\\n      44 |\\n    > 45 |             expect(sessions.length).toBe(2);\\n         |                                     ^\\n      46 |             expect(sessions[0].sessionId).toBe('abc123');\\n      47 |         });\\n      48 |\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:45:37)\\n\\n  \\u25cf SessionDiscovery \\u203a findSessions \\u203a should sort sessions by mtime descending\\n\\n    expect(received).toBe(expected) // Object.is equality\\n\\n    Expected: \\\"new\\\"\\n    Received: \\\"old\\\"\\n\\n      56 |             const sessions = await discovery.findSessions();\\n      57 |\\n    > 58 |             expect(sessions[0].sessionId).toBe('new');\\n         |                                           ^\\n      59 |             expect(sessions[1].sessionId).toBe('old');\\n      60 |         });\\n      61 |\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:58:43)\\n\\n  \\u25cf SessionDiscovery \\u203a findSessions \\u203a should skip unreadable files without error\\n\\n    expect(received).toBe(expected) // Object.is equality\\n\\n    Expected: 1\\n    Received: 3\\n\\n      81 |             const sessions = await discovery.findSessions();\\n      82 |\\n    > 83 |             expect(sessions.length).toBe(1);\\n         |                                     ^\\n      84 |             expect(sessions[0].sessionId).toBe('good');\\n      85 |         });\\n      86 |     });\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:83:37)\\n\\n  \\u25cf SessionDiscovery \\u203a getLatestSession \\u203a should return the most recent session\\n\\n    expect(received).toBe(expected) // Object.is equality\\n\\n    Expected: \\\"newest\\\"\\n    Received: \\\"older\\\"\\n\\n      104 |             const session = await discovery.getLatestSession();\\n      105 |\\n    > 106 |             expect(session?.sessionId).toBe('newest');\\n          |                                        ^\\n      107 |         });\\n      108 |     });\\n      109 |\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:106:40)\\n\\n  \\u25cf SessionDiscovery \\u203a caching \\u203a should cache results for 60 seconds\\n\\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\\n\\n    Expected number of calls: 1\\n    Received number of calls: 2\\n\\n      140 |\\n      141 |             // readdirSync should only be called once due to caching\\n    > 142 |             expect(mockFs.readdirSync).toHaveBeenCalledTimes(1);\\n          |                                        ^\\n      143 |         });\\n      144 |\\n      145 |         it('should clear cache when clearCache is called', async () => {\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:142:40)\\n\\n  \\u25cf SessionDiscovery \\u203a caching \\u203a should clear cache when clearCache is called\\n\\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\\n\\n    Expected number of calls: 2\\n    Received number of calls: 4\\n\\n      152 |             await discovery.findSessions();\\n      153 |\\n    > 154 |             expect(mockFs.readdirSync).toHaveBeenCalledTimes(2);\\n          |                                        ^\\n      155 |         });\\n      156 |     });\\n      157 | });\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:154:40)\\n\\nPASS tests/unit/state-bridge/session-parser.test.ts\\nPASS tests/unit/state-bridge/context-injector.test.ts\\nJest: \\\"global\\\" coverage threshold for branches (80%) not met: 61.36%\\n\\nTest Suites: 1 failed, 2 passed, 3 total\\nTests:       6 failed, 31 passed, 37 total\\nSnapshots:   0 total\\nTime:        0.769 s, estimated 1 s\\nRan all test suites.\\nTest results written to: test-results.json\\n\", \"stderr\": \"sh: 1: Bad substitution\\n\", \"success\": false}"
}