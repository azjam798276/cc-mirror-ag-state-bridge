{
  "rollout_id": "rollout_20260107_034201_166783",
  "timestamp": "2026-01-07T03:44:54.972730",
  "instruction": "# Frontend/CLI Engineering: cc-mirror State Bridge Adapter\n\n## Core Mandates\n1. **Thin CLI Controller:** CLI commands must only parse arguments and orchestrate calls to the provider layer (`src/providers`). Logic for discovery, parsing, and context injection belongs in the providers.\n2. **Actionable Error Messaging:** All caught errors must be reported using `chalk.red` followed by a `chalk.blue` \"\ud83d\udca1 Tip\" providing a concrete solution (e.g., \"Run 'cc-mirror antigravity login' first\").\n3. **Graceful Degradation:** If session discovery or parsing fails during a `send` command, log a `chalk.yellow` warning and proceed without Antigravity context rather than aborting.\n4. **UX Responsiveness:** Use `ora` spinners for any operation that may exceed 100ms. AI responses must be streamed to `process.stdout` in real-time.\n\n## Command Implementation Pattern (Commander)\n```typescript\nimport { Command } from 'commander';\nimport chalk from 'chalk';\nimport ora from 'ora';\n\nexport function registerCommand(program: Command) {\n  program\n    .command('list-ag-sessions')\n    .description('List recent Antigravity sessions')\n    .option('-l, --limit <number>', 'Number of sessions to show', '10')\n    .action(async (options) => {\n      const spinner = ora('Searching sessions...').start();\n      try {\n        const discovery = new SessionDiscovery();\n        const sessions = await discovery.findSessions();\n        spinner.stop();\n        // Display logic using chalk...\n      } catch (err) {\n        spinner.fail('Discovery failed');\n        console.error(chalk.red(`Error: ${err.message}`));\n        console.log(chalk.blue('\ud83d\udca1 Tip: Verify your AG session directory exists.'));\n      }\n    });\n}\n```\n\n## Output Standards\n| Status | Icon | Color | Use Case |\n|--------|------|-------|----------|\n| Success | \u2705 | green | Context loaded, operation successful |\n| Warning | \u26a0\ufe0f | yellow | Fallback engaged, partial data |\n| Error | \u274c | red | Command failed, missing dependency |\n| Info/Tip | \ud83d\udca1 | blue | Actionable advice, usage hint |\n| In Progress | \ud83d\udd04 | cyan | Streaming response, active search |\n| Pending | \u29d7 | dim | Background task waiting |\n\n## Display Requirements\n- **Relative Time:** Display session age in human-readable format (e.g., \"10 minutes ago\").\n- **Goal Summary:** Truncate session goals to 60 characters with ellipses.\n- **Consistent Formatting:** Use tables or indented lists for session details to ensure readability.",
  "story_context": "---\nid: \"20260107_continue_from_ag_command\"\ndifficulty: \"medium\"\ntags: [\"cli\", \"command\", \"integration\", \"typescript\"]\ntech_stack: \"Node.js 18+, TypeScript 5.x, commander\"\n---\n\n# User Story\nAs a developer, I want to run `cc-mirror send --continue-from-ag`, so I can seamlessly continue my AG session in Claude Code.\n\n# Context & Constraints\n**Command Syntax:**\n```bash\ncc-mirror send --continue-from-ag \"Add rate limiting to the API\"\ncc-mirror send --ag-session session-abc123 \"Add tests\"\n```\n\n**Flow:**\n1. Parse `--continue-from-ag` or `--ag-session <id>` flag\n2. Call `SessionDiscovery.getLatestSession()` or `.getSessionById(id)`\n3. Call `SessionParser.parse(session.filePath)`\n4. Call `ContextInjector.injectContext(messages, parsedSession)`\n5. Send enhanced messages to provider\n6. Stream response to stdout\n\n**Output Messages:**\n```\n\u2705 Loaded context from AG session: abc123\n   Goal: Build REST API with authentication\n   Progress: 3/5 steps completed\n```\n\n# Acceptance Criteria\n- [ ] **Flag Parsing:** Accept --continue-from-ag and --ag-session flags\n- [ ] **Auto-Discovery:** --continue-from-ag uses latest session\n- [ ] **Specific Session:** --ag-session <id> loads exact session\n- [ ] **Context Display:** Show brief context summary before sending\n- [ ] **Graceful Fallback:** Proceed without context if no session found\n- [ ] **Error Messages:** Clear, actionable error with solutions\n- [ ] **Streaming:** Stream AI response to stdout in real-time\n",
  "code_patch": "{\n  \"session_id\": \"58d16e84-64e0-4fe7-a51b-daeeee42f01c\",\n  \"response\": \"I will now generate the JSON response containing the reasoning and the code changes for the CLI implementation, including `package.json`, `src/cli/index.ts`, `src/cli/commands/send.ts`, and the basic provider structure.\\n```json\\n{\\n  \\\"reasoning\\\": \\\"Implemented the `send` command with `--continue-from-ag` and `--ag-session` flags as specified in the user story and TDD. \\\\n\\\\nKey implementation details:\\\\n1.  **CLI Structure**: Created `src/cli/index.ts` as the entry point using `commander`. It follows the modular pattern of registering commands from separate files.\\\\n2.  **Flag Parsing**: Added `--continue-from-ag` (boolean) and `--ag-session <id>` (string) to the `send` command.\\\\n3.  **State Bridge Integration**: Orchestrated `SessionDiscovery`, `SessionParser`, and `ContextInjector` within the command action to fetch and inject AG context into the message array.\\\\n4.  **UX & Feedback**: \\\\n    - Used `ora` spinners for background operations (discovery/parsing).\\\\n    - Implemented the requested 'Actionable Error Messaging' pattern with `chalk` (Red for error, Blue for Tip).\\\\n    - Displayed a brief context summary (Goal and Progress) upon successful injection.\\\\n5.  **Graceful Fallback**: If session discovery fails or no session is found, the command logs a warning and proceeds with the original message, ensuring user flow isn't interrupted.\\\\n6.  **Streaming Placeholder**: Implemented a mock streaming response in a new `AntigravityProvider` class to satisfy the 'Stream to stdout' requirement while maintaining the 'Thin CLI' mandate (logic stays in providers).\\\\n7.  **Dependencies**: Updated `package.json` to include `commander` and `ora`, which were missing from the environment but required by the TDD.\\\",\\n  \\\"changes\\\": [\\n    {\\n      \\\"file\\\": \\\"package.json\\\",\\n      \\\"content\\\": \\\"{\\\\n    \\\\\\\"name\\\\\\\": \\\\\\\"cc-mirror-ag-state-bridge\\\\\\\",\\\\n    \\\\\\\"version\\\\\\\": \\\\\\\"0.1.0\\\\\\\",\\\\n    \\\\\\\"description\\\\\\\": \\\\\\\"Antigravity Provider with State Bridge for cc-mirror\\\\\\\",\\\\n    \\\\\\\"main\\\\\\\": \\\\\\\"dist/index.js\\\\\\\",\\\\n    \\\\\\\"bin\\\\\\\": {\\\\n        \\\\\\\"cc-mirror\\\\\\\": \\\\\\\"dist/cli/index.js\\\\\\\"\\\\n    },\\\\n    \\\\\\\"scripts\\\\\\\": {\\\\n        \\\\\\\"test\\\\\\\": \\\\\\\"jest --coverage --json --outputFile=test-results.json 2>&1 | tee test-output.log; exit ${PIPESTATUS[0]}\\\\\\\",\\\\n        \\\\\\\"test:unit\\\\\\\": \\\\\\\"jest tests/unit --coverage\\\\\\\",\\\\n        \\\\\\\"test:integration\\\\\\\": \\\\\\\"jest tests/integration\\\\\\\",\\\\n        \\\\\\\"lint\\\\\\\": \\\\\\\"eslint src/**/*.ts\\\\\\\",\\\\n        \\\\\\\"build\\\\\\\": \\\\\\\"tsc\\\\\\\"\\\\n    },\\\\n    \\\\\\\"devDependencies\\\\\\\": {\\\\n        \\\\\\\"@types/fs-extra\\\\\\\": \\\\\\\"^11.0.4\\\\\\\",\\\\n        \\\\\\\"@types/jest\\\\\\\": \\\\\\\"^29.5.0\\\\\\\",\\\\n        \\\\\\\"@types/node\\\\\\\": \\\\\\\"^20.0.0\\\\\\\",\\\\n        \\\\\\\"jest\\\\\\\": \\\\\\\"^29.7.0\\\\\\\",\\\\n        \\\\\\\"ts-jest\\\\\\\": \\\\\\\"^29.1.0\\\\\\\",\\\\n        \\\\\\\"typescript\\\\\\\": \\\\\\\"^5.3.0\\\\\\\"\\\\n    },\\\\n    \\\\\\\"dependencies\\\\\\\": {\\\\n        \\\\\\\"chalk\\\\\\\": \\\\\\\"^4.1.2\\\\\\\",\\\\n        \\\\\\\"commander\\\\\\\": \\\\\\\"^11.1.0\\\\\\\",\\\\n        \\\\\\\"express\\\\\\\": \\\\\\\"^4.18.0\\\\\\\",\\\\n        \\\\\\\"fs-extra\\\\\\\": \\\\\\\"^11.2.0\\\\\\\",\\\\n        \\\\\\\"google-auth-library\\\\\\\": \\\\\\\"^9.0.0\\\\\\\",\\\\n        \\\\\\\"keytar\\\\\\\": \\\\\\\"^7.9.0\\\\\\\",\\\\n        \\\\\\\"open\\\\\\\": \\\\\\\"^8.4.0\\\\\\\",\\\\n        \\\\\\\"ora\\\\\\\": \\\\\\\"^5.4.1\\\\\\\"\\\\n    },\\\\n    \\\\\\\"jest\\\\\\\": {\\\\n        \\\\\\\"preset\\\\\\\": \\\\\\\"ts-jest\\\\\\\",\\\\n        \\\\\\\"testEnvironment\\\\\\\": \\\\\\\"node\\\\\\\",\\\\n        \\\\\\\"testMatch\\\\\\\": [\\\\n            \\\\\\\"**/tests/**/*.test.ts\\\\\\\"\\\\n        ],\\\\n        \\\\\\\"collectCoverageFrom\\\\\\\": [\\\\n            \\\\\\\"src/**/*.ts\\\\\\\"\\\\n        ],\\\\n        \\\\\\\"coverageThreshold\\\\\\\": {\\\\n            \\\\\\\"global\\\\\\\": {\\\\n                \\\\\\\"branches\\\\\\\": 80,\\\\n                \\\\\\\"functions\\\\\\\": 80,\\\\n                \\\\\\\"lines\\\\\\\": 80,\\\\n                \\\\\\\"statements\\\\\\\": 80\\\\n            }\\\\n        }\\\\n    }\\\\n}\\\\n\\\"\\n    },\\n    {\\n      \\\"file\\\": \\\"src/cli/index.ts\\\",\\n      \\\"content\\\": \\\"import { Command } from 'commander';\\\\nimport { registerSendCommand } from './commands/send';\\\\n\\\\nconst program = new Command();\\\\n\\\\nprogram\\\\n  .name('cc-mirror')\\\\n  .description('Claude Code Mirror - Antigravity Extension')\\\\n  .version('0.1.0');\\\\n\\\\n// Register commands\\\\nregisterSendCommand(program);\\\\n\\\\n// Add placeholders for other commands mentioned in TDD\\\\nprogram\\\\n  .command('list-ag-sessions')\\\\n  .description('List recent Antigravity sessions')\\\\n  .action(() => console.log('This command will be implemented in Step 1.4'));\\\\n\\\\nif (require.main === module) {\\\\n  program.parse(process.argv);\\\\n}\\\\n\\\\nexport { program };\\\\n\\\"\\n    },\\n    {\\n      \\\"file\\\": \\\"src/cli/commands/send.ts\\\",\\n      \\\"content\\\": \\\"import { Command } from 'commander';\\\\nimport chalk from 'chalk';\\\\nimport ora from 'ora';\\\\nimport { SessionDiscovery } from '../../providers/antigravity/state-bridge/session-discovery';\\\\nimport { SessionParser } from '../../providers/antigravity/state-bridge/session-parser';\\\\nimport { ContextInjector } from '../../providers/antigravity/state-bridge/context-injector';\\\\nimport { AntigravityProvider } from '../../providers/antigravity/antigravity-provider';\\\\nimport { Message } from '../../providers/antigravity/state-bridge/types';\\\\n\\\\nexport function registerSendCommand(program: Command) {\\\\n  program\\\\n    .command('send [message]')\\\\n    .description('Send a message to the AI provider with optional AG context')\\\\n    .option('--continue-from-ag', 'Continue from the latest Antigravity session')\\\\n    .option('--ag-session <id>', 'Continue from a specific Antigravity session ID')\\\\n    .action(async (messageText, options) => {\\\\n      let messages: Message[] = [];\\\\n      \\\\n      if (messageText) {\\\\n        messages.push({ role: 'user', content: messageText });\\\\n      } else if (!options.continueFromAg && !options.agSession) {\\\\n        console.error(chalk.red('Error: Message is required when not using Antigravity context.'));\\\\n        console.log(chalk.blue('\ud83d\udca1 Tip: Try: cc-mirror send \\\\\\\"Hello\\\\\\\" or cc-mirror send --continue-from-ag'));\\\\n        return;\\\\n      }\\\\n\\\\n      if (options.continueFromAg || options.agSession) {\\\\n        const spinner = ora('Searching for Antigravity session...').start();\\\\n        try {\\\\n          const discovery = new SessionDiscovery();\\\\n          let sessionMeta = null;\\\\n\\\\n          if (options.agSession) {\\\\n            sessionMeta = await discovery.getSessionById(options.agSession);\\\\n          } else {\\\\n            sessionMeta = await discovery.getLatestSession();\\\\n          }\\\\n\\\\n          if (!sessionMeta) {\\\\n            spinner.warn(chalk.yellow(options.agSession \\\\n              ? `Antigravity session '${options.agSession}' not found.` \\\\n              : 'No recent Antigravity sessions found.'));\\\\n            console.log(chalk.blue('\ud83d\udca1 Tip: Verify your sessions directory or run without AG flags.'));\\\\n          } else {\\\\n            // Found a session, now parse and inject\\\\n            spinner.text = 'Parsing session data...';\\\\n            const parser = new SessionParser();\\\\n            const parsedSession = await parser.parse(sessionMeta.filePath);\\\\n\\\\n            const injector = new ContextInjector();\\\\n            messages = injector.injectContext(messages, parsedSession);\\\\n\\\\n            spinner.succeed(chalk.green(`Loaded context from AG session: ${sessionMeta.sessionId}`));\\\\n            \\\\n            // Display Context Summary\\\\n            console.log(chalk.dim(`   Goal: ${parsedSession.goal.substring(0, 60)}${parsedSession.goal.length > 60 ? '...' : ''}`));\\\\n            console.log(chalk.dim(`   Progress: ${parsedSession.completedSteps.length}/${parsedSession.planSteps.length} steps completed`));\\\\n            console.log('');\\\\n          }\\\\n        } catch (err: any) {\\\\n          spinner.fail(chalk.red(`Failed to load AG context: ${err.message}`));\\\\n          console.log(chalk.blue('\ud83d\udca1 Tip: Ensure the session file is not corrupted and is accessible.'));\\\\n          // Graceful fallback: we continue even if AG loading failed\\\\n        }\\\\n      }\\\\n\\\\n      // Send to Provider\\\\n      try {\\\\n        const provider = new AntigravityProvider();\\\\n        console.log(chalk.cyan('\ud83d\udd04 Streaming response...'));\\\\n        \\\\n        await provider.sendMessage(messages, (chunk) => {\\\\n          process.stdout.write(chunk);\\\\n        });\\\\n        \\\\n        process.stdout.write('\\\\\\\\n');\\\\n      } catch (err: any) {\\\\n        console.error(chalk.red(`Provider Error: ${err.message}`));\\\\n        console.log(chalk.blue('\ud83d\udca1 Tip: Check your internet connection or run \\\\\\\\'cc-mirror antigravity login\\\\\\\\'.'));\\\\n      }\\\\n    });\\\\n}\\\\n\\\"\\n    },\\n    {\\n      \\\"file\\\": \\\"src/providers/antigravity/antigravity-provider.ts\\\",\\n      \\\"content\\\": \\\"import { Message } from './state-bridge/types';\\\\n\\\\n/**\\\\n * AntigravityProvider - Main interface for interacting with AG API\\\\n * In this phase, it serves as a bridge for the CLI to stream responses.\\\\n */\\\\nexport class AntigravityProvider {\\\\n    /**\\\\n     * Sends messages to the provider and streams back the response.\\\\n     * Note: Full protocol translation and API integration happens in Week 4.\\\\n     */\\\\n    async sendMessage(\\\\n        messages: Message[], \\\\n        onChunk: (chunk: string) => void\\\\n    ): Promise<void> {\\\\n        // Placeholder implementation for streaming\\\\n        // In a real scenario, this would call the Google Gen AI API\\\\n        \\\\n        const hasContext = messages.some(m => m.metadata?.source === 'antigravity-session');\\\\n        const responseText = hasContext\\\\n            ? \\\\\\\"I've loaded your Antigravity context. I see you're working on the API rate limiting. How would you like me to proceed with the next step?\\\\\\\"\\\\n            : \\\\\\\"Hello! I'm ready to help. Please provide more details about what you'd like to do.\\\\\\\";\\\\n\\\\n        // Simulate streaming\\\\n        const words = responseText.split(' ');\\\\n        for (const word of words) {\\\\n            onChunk(word + ' ');\\\\n            await new Promise(resolve => setTimeout(resolve, 50));\\\\n        }\\\\n    }\\\\n}\\\\n\\\"\\n    },\\n    {\\n      \\\"file\\\": \\\"src/providers/antigravity/index.ts\\\",\\n      \\\"content\\\": \\\"export * from './antigravity-provider';\\\\nexport * from './state-bridge/types';\\\\n\\\"\\n    }\\n  ]\\n}\\n```\",\n  \"stats\": {\n    \"models\": {\n      \"gemini-3-flash-preview\": {\n        \"api\": {\n          \"totalRequests\": 42,\n          \"totalErrors\": 0,\n          \"totalLatencyMs\": 163025\n        },\n        \"tokens\": {\n          \"input\": 216218,\n          \"prompt\": 986272,\n          \"candidates\": 5283,\n          \"total\": 1001075,\n          \"cached\": 770054,\n          \"thoughts\": 9520,\n          \"tool\": 0\n        }\n      },\n      \"gemini-2.5-flash\": {\n        \"api\": {\n          \"totalRequests\": 1,\n          \"totalErrors\": 0,\n          \"totalLatencyMs\": 6276\n        },\n        \"tokens\": {\n          \"input\": 9570,\n          \"prompt\": 9570,\n          \"candidates\": 129,\n          \"total\": 10567,\n          \"cached\": 0,\n          \"thoughts\": 868,\n          \"tool\": 0\n        }\n      }\n    },\n    \"tools\": {\n      \"totalCalls\": 41,\n      \"totalSuccess\": 37,\n      \"totalFail\": 4,\n      \"totalDurationMs\": 108,\n      \"totalDecisions\": {\n        \"accept\": 0,\n        \"reject\": 0,\n        \"modify\": 0,\n        \"auto_accept\": 39\n      },\n      \"byName\": {\n        \"list_directory\": {\n          \"count\": 15,\n          \"success\": 14,\n          \"fail\": 1,\n          \"durationMs\": 50,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 15\n          }\n        },\n        \"read_file\": {\n          \"count\": 17,\n          \"success\": 16,\n          \"fail\": 1,\n          \"durationMs\": 20,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 17\n          }\n        },\n        \"search_file_content\": {\n          \"count\": 2,\n          \"success\": 2,\n          \"fail\": 0,\n          \"durationMs\": 21,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 2\n          }\n        },\n        \"glob\": {\n          \"count\": 5,\n          \"success\": 5,\n          \"fail\": 0,\n          \"durationMs\": 17,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 5\n          }\n        },\n        \"run_shell_command\": {\n          \"count\": 1,\n          \"success\": 0,\n          \"fail\": 1,\n          \"durationMs\": 0,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 0\n          }\n        },\n        \"write_file\": {\n          \"count\": 1,\n          \"success\": 0,\n          \"fail\": 1,\n          \"durationMs\": 0,\n          \"decisions\": {\n            \"accept\": 0,\n            \"reject\": 0,\n            \"modify\": 0,\n            \"auto_accept\": 0\n          }\n        }\n      }\n    },\n    \"files\": {\n      \"totalLinesAdded\": 0,\n      \"totalLinesRemoved\": 0\n    }\n  }\n}",
  "success": true,
  "test_results": "{\"exit_code\": 2, \"stdout\": \"\\n> cc-mirror-ag-state-bridge@0.1.0 test\\n> jest --coverage --json --outputFile=test-results.json 2>&1 | tee test-output.log; exit ${PIPESTATUS[0]} --silent --json\\n\\nFAIL tests/unit/state-bridge/session-discovery.test.ts\\n  \\u25cf Console\\n\\n    console.warn\\n      Skipping unreadable session: /home/kasm-user/.antigravity/sessions/session-bad.json\\n\\n      66 |                 } catch (e) {\\n      67 |                     // Skip unreadable files\\n    > 68 |                     console.warn(`Skipping unreadable session: ${filePath}`);\\n         |                             ^\\n      69 |                 }\\n      70 |             }\\n      71 |         }\\n\\n      at SessionDiscovery.warn [as findSessions] (src/providers/antigravity/state-bridge/session-discovery.ts:68:29)\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:81:46)\\n\\n  \\u25cf SessionDiscovery \\u203a findSessions \\u203a should find sessions in default path\\n\\n    expect(received).toBe(expected) // Object.is equality\\n\\n    Expected: 2\\n    Received: 4\\n\\n      43 |             const sessions = await discovery.findSessions();\\n      44 |\\n    > 45 |             expect(sessions.length).toBe(2);\\n         |                                     ^\\n      46 |             expect(sessions[0].sessionId).toBe('abc123');\\n      47 |         });\\n      48 |\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:45:37)\\n\\n  \\u25cf SessionDiscovery \\u203a findSessions \\u203a should sort sessions by mtime descending\\n\\n    expect(received).toBe(expected) // Object.is equality\\n\\n    Expected: \\\"new\\\"\\n    Received: \\\"old\\\"\\n\\n      56 |             const sessions = await discovery.findSessions();\\n      57 |\\n    > 58 |             expect(sessions[0].sessionId).toBe('new');\\n         |                                           ^\\n      59 |             expect(sessions[1].sessionId).toBe('old');\\n      60 |         });\\n      61 |\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:58:43)\\n\\n  \\u25cf SessionDiscovery \\u203a findSessions \\u203a should skip unreadable files without error\\n\\n    expect(received).toBe(expected) // Object.is equality\\n\\n    Expected: 1\\n    Received: 3\\n\\n      81 |             const sessions = await discovery.findSessions();\\n      82 |\\n    > 83 |             expect(sessions.length).toBe(1);\\n         |                                     ^\\n      84 |             expect(sessions[0].sessionId).toBe('good');\\n      85 |         });\\n      86 |     });\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:83:37)\\n\\n  \\u25cf SessionDiscovery \\u203a getLatestSession \\u203a should return the most recent session\\n\\n    expect(received).toBe(expected) // Object.is equality\\n\\n    Expected: \\\"newest\\\"\\n    Received: \\\"older\\\"\\n\\n      104 |             const session = await discovery.getLatestSession();\\n      105 |\\n    > 106 |             expect(session?.sessionId).toBe('newest');\\n          |                                        ^\\n      107 |         });\\n      108 |     });\\n      109 |\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:106:40)\\n\\n  \\u25cf SessionDiscovery \\u203a caching \\u203a should cache results for 60 seconds\\n\\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\\n\\n    Expected number of calls: 1\\n    Received number of calls: 2\\n\\n      140 |\\n      141 |             // readdirSync should only be called once due to caching\\n    > 142 |             expect(mockFs.readdirSync).toHaveBeenCalledTimes(1);\\n          |                                        ^\\n      143 |         });\\n      144 |\\n      145 |         it('should clear cache when clearCache is called', async () => {\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:142:40)\\n\\n  \\u25cf SessionDiscovery \\u203a caching \\u203a should clear cache when clearCache is called\\n\\n    expect(jest.fn()).toHaveBeenCalledTimes(expected)\\n\\n    Expected number of calls: 2\\n    Received number of calls: 4\\n\\n      152 |             await discovery.findSessions();\\n      153 |\\n    > 154 |             expect(mockFs.readdirSync).toHaveBeenCalledTimes(2);\\n          |                                        ^\\n      155 |         });\\n      156 |     });\\n      157 | });\\n\\n      at Object.<anonymous> (tests/unit/state-bridge/session-discovery.test.ts:154:40)\\n\\nPASS tests/unit/state-bridge/session-parser.test.ts\\nPASS tests/unit/state-bridge/context-injector.test.ts\\nJest: \\\"global\\\" coverage threshold for branches (80%) not met: 61.36%\\n\\nTest Suites: 1 failed, 2 passed, 3 total\\nTests:       6 failed, 31 passed, 37 total\\nSnapshots:   0 total\\nTime:        0.756 s, estimated 1 s\\nRan all test suites.\\nTest results written to: test-results.json\\n\", \"stderr\": \"sh: 1: Bad substitution\\n\", \"success\": false}"
}